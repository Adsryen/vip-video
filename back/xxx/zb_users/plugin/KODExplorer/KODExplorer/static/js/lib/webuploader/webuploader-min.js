/* WebUploader 0.1.5 */
var dragEnter=dragOver=dragLeave=dragDrop=function(){};(function(B,F){var E={},I=function(N,O){var L,K,M;if(typeof N==="string"){return C(N)}else{L=[];for(K=N.length,M=0;M<K;M++){L.push(C(N[M]))}return O.apply(null,L)}},A=function(M,K,L){if(arguments.length===2){L=K;K=null}I(K||[],function(){G(M,L,arguments)})},G=function(N,M,L){var K={exports:M},O;if(typeof M==="function"){L.length||(L=[I,K.exports,K]);O=M.apply(null,L);O!==undefined&&(K.exports=O)}E[N]=K.exports},C=function(L){var K=E[L]||B[L];if(!K){throw new Error("`"+L+"` is undefined")}return K},J=function(Q){var L,O,P,K,M,N;N=function(R){return R&&(R.charAt(0).toUpperCase()+R.substr(1))};for(L in E){O=Q;if(!E.hasOwnProperty(L)){continue}P=L.split("/");M=N(P.pop());while((K=N(P.shift()))){O[K]=O[K]||{};O=O[K]}O[M]=E[L]}return Q},D=function(K){B.__dollar=K;return J(F(B,A,I))},H;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=D()}else{if(typeof define==="function"&&define.amd){define(["jQuery"],D)}else{H=B.WebUploader;B.WebUploader=D();B.WebUploader.noConflict=function(){B.WebUploader=H}}}})(window,function(C,A,B){A("dollar-third",[],function(){var D=C.__dollar||C.jQuery||C.Zepto;if(!D){throw new Error("jQuery or Zepto not found!")}return D});A("dollar",["dollar-third"],function(D){return D});A("promise-third",["dollar"],function(D){return{Deferred:D.Deferred,when:D.when,isPromise:function(E){return E&&typeof E.then==="function"}}});A("promise",["promise-third"],function(D){return D});A("base",["dollar","promise"],function(G,J){var I=function(){},H=Function.call;function D(K){return function(){return H.apply(K,arguments)}}function F(K,L){return function(){return K.apply(L,arguments)}}function E(K){var L;if(Object.create){return Object.create(K)}else{L=function(){};L.prototype=K;return new L()}}return{version:"0.1.5",$:G,Deferred:J.Deferred,isPromise:J.isPromise,when:J.when,browser:(function(P){var L={},M=P.match(/WebKit\/([\d.]+)/),O=P.match(/Chrome\/([\d.]+)/)||P.match(/CriOS\/([\d.]+)/),N=P.match(/MSIE\s([\d\.]+)/)||P.match(/(?:trident)(?:.*rv:([\w.]+))?/i),K=P.match(/Firefox\/([\d.]+)/),Q=P.match(/Safari\/([\d.]+)/),R=P.match(/OPR\/([\d.]+)/);M&&(L.webkit=parseFloat(M[1]));O&&(L.chrome=parseFloat(O[1]));N&&(L.ie=parseFloat(N[1]));K&&(L.firefox=parseFloat(K[1]));Q&&(L.safari=parseFloat(Q[1]));R&&(L.opera=parseFloat(R[1]));return L})(navigator.userAgent),os:(function(N){var M={},K=N.match(/(?:Android);?[\s\/]+([\d.]+)?/),L=N.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);K&&(M.android=parseFloat(K[1]));L&&(M.ios=parseFloat(L[1].replace(/_/g,".")));return M})(navigator.userAgent),inherits:function(M,K,N){var L;if(typeof K==="function"){L=K;K=null}else{if(K&&K.hasOwnProperty("constructor")){L=K.constructor}else{L=function(){return M.apply(this,arguments)}}}G.extend(true,L,M,N||{});L.__super__=M.prototype;L.prototype=E(M.prototype);K&&G.extend(true,L.prototype,K);return L},noop:I,bindFn:F,log:(function(){if(C.console){return F(console.log,console)}return I})(),nextTick:(function(){return function(K){setTimeout(K,1)}})(),slice:D([].slice),guid:(function(){var K=0;return function(L){var M=(+new Date()).toString(32),N=0;for(;N<5;N++){M+=Math.floor(Math.random()*65535).toString(32)}return(L||"wu_")+M+(K++).toString(32)}})(),formatSize:function(K,N,L){var M;L=L||["B","K","M","G","TB"];while((M=L.shift())&&K>1024){K=K/1024}return(M==="B"?K:K.toFixed(N||2))+M}}});A("mediator",["base"],function(J){var F=J.$,E=[].slice,H=/\s+/,D;function K(M,L,O,N){return F.grep(M,function(P){return P&&(!L||P.e===L)&&(!O||P.cb===O||P.cb._cb===O)&&(!N||P.ctx===N)})}function I(M,N,L){F.each((M||"").split(H),function(P,O){L(O,N)})}function G(O,M){var Q=false,P=-1,L=O.length,N;while(++P<L){N=O[P];if(N.cb.apply(N.ctx2,M)===false){Q=true;break}}return !Q}D={on:function(M,P,N){var L=this,O;if(!P){return this}O=this._events||(this._events=[]);I(M,P,function(Q,S){var R={e:Q};R.cb=S;R.ctx=N;R.ctx2=N||L;R.id=O.length;O.push(R)});return this},once:function(M,O,N){var L=this;if(!O){return L}I(M,O,function(Q,R){var P=function(){L.off(Q,P);return R.apply(N||L,arguments)};P._cb=R;L.on(Q,P,N)});return L},off:function(M,L,O){var N=this._events;if(!N){return this}if(!M&&!L&&!O){this._events=[];return this}I(M,L,function(Q,P){F.each(K(N,Q,P,O),function(){delete N[this.id]})});return this},trigger:function(N){var L,M,O;if(!this._events||!N){return this}L=E.call(arguments,1);M=K(this._events,N);O=K(this._events,"all");return G(M,L)&&G(O,arguments)}};return F.extend({installTo:function(L){return F.extend(L,D)}},D)});A("uploader",["base","mediator"],function(E,G){var F=E.$;function D(H){this.options=F.extend(true,{},D.options,H);this._init(this.options)}D.options={};G.installTo(D.prototype);F.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(H,I){D.prototype[H]=function(){return this.request(I,arguments)}});F.extend(D.prototype,{state:"pending",_init:function(H){var I=this;I.request("init",H,function(){I.state="ready";I.trigger("ready")})},option:function(I,J){var H=this.options;if(arguments.length>1){if(F.isPlainObject(J)&&F.isPlainObject(H[I])){F.extend(H[I],J)}else{H[I]=J}}else{return I?H[I]:H}},getStats:function(){var H=this.request("get-stats");return{successNum:H.numOfSuccess,progressNum:H.numOfProgress,cancelNum:H.numOfCancel,invalidNum:H.numOfInvalid,uploadFailNum:H.numOfUploadFailed,queueNum:H.numOfQueue}},trigger:function(K){var J=[].slice.call(arguments,1),H=this.options,I="on"+K.substring(0,1).toUpperCase()+K.substring(1);if(G.trigger.apply(this,arguments)===false||F.isFunction(H[I])&&H[I].apply(this,J)===false||F.isFunction(this[I])&&this[I].apply(this,J)===false||G.trigger.apply(G,[this,K].concat(J))===false){return false}return true},request:E.noop});E.create=D.create=function(H){return new D(H)};E.Uploader=D;return D});A("runtime/runtime",["base","mediator"],function(E,H){var G=E.$,I={},D=function(K){for(var J in K){if(K.hasOwnProperty(J)){return J}}return null};function F(J){this.options=G.extend({container:document.body},J);this.uid=E.guid("rt_")}G.extend(F.prototype,{getContainer:function(){var J=this.options,L,K;if(this._container){return this._container}L=G(J.container||document.body);K=G(document.createElement("div"));K.attr("id","rt_"+this.uid);K.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});L.append(K);L.addClass("webuploader-container");this._container=K;return K},init:E.noop,exec:E.noop,destroy:function(){if(this._container){this._container.parentNode.removeChild(this.__container)}this.off()}});F.orders="html5,flash";F.addRuntime=function(J,K){I[J]=K};F.hasRuntime=function(J){return !!(J?I[J]:D(I))};F.create=function(J,K){var L,M;K=K||F.orders;G.each(K.split(/\s*,\s*/g),function(){if(I[this]){L=this;return false}});L=L||D(I);if(!L){throw new Error("Runtime Error")}M=new I[L](J);return M};H.installTo(F.prototype);return F});A("runtime/client",["base","mediator","runtime/runtime"],function(E,G,F){var D;D=(function(){var I={};return{add:function(J){I[J.uid]=J},get:function(K,L){var J;if(K){return I[K]}for(J in I){if(L&&I[J].__standalone){continue}return I[J]}return null},remove:function(J){delete I[J.uid]}}})();function H(I,K){var J=E.Deferred(),L;this.uid=E.guid("client_");this.runtimeReady=function(M){return J.done(M)};this.connectRuntime=function(M,N){if(L){throw new Error("already connected!")}J.done(N);if(typeof M==="string"&&D.get(M)){L=D.get(M)}L=L||D.get(null,K);if(!L){L=F.create(M,M.runtimeOrder);L.__promise=J.promise();L.once("ready",J.resolve);L.init();D.add(L);L.__client=1}else{E.$.extend(L.options,M);L.__promise.then(J.resolve);L.__client++}K&&(L.__standalone=K);return L};this.getRuntime=function(){return L};this.disconnectRuntime=function(){if(!L){return}L.__client--;if(L.__client<=0){D.remove(L);delete L.__promise;L.destroy()}L=null};this.exec=function(){if(!L){return}var M=E.slice(arguments);I&&M.unshift(I);return L.exec.apply(this,M)};this.getRuid=function(){return L&&L.uid};this.destroy=(function(M){return function(){M&&M.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}})(this.destroy)}G.installTo(H.prototype);return H});A("lib/dnd",["base","mediator","runtime/client"],function(D,H,F){var E=D.$;function G(I){I=this.options=E.extend({},G.options,I);I.container=E(I.container);if(!I.container.length){return}F.call(this,"DragAndDrop")}G.options={accept:null,disableGlobalDnd:false};D.inherits(F,{constructor:G,init:function(){var I=this;I.connectRuntime(I.options,function(){I.exec("init");I.trigger("ready")})},destroy:function(){this.disconnectRuntime()}});H.installTo(G.prototype);return G});A("widgets/widget",["base","uploader"],function(J,H){var F=J.$,I=H.prototype._init,K={},E=[];function D(N){if(!N){return false}var M=N.length,L=F.type(N);if(N.nodeType===1&&M){return true}return L==="array"||L!=="function"&&L!=="string"&&(M===0||typeof M==="number"&&M>0&&(M-1) in N)}function G(L){this.owner=L;this.options=L.options}F.extend(G.prototype,{init:J.noop,invoke:function(N,L){var M=this.responseMap;if(!M||!(N in M)||!(M[N] in this)||!F.isFunction(this[M[N]])){return K}return this[M[N]].apply(this,L)},request:function(){return this.owner.request.apply(this.owner,arguments)}});F.extend(H.prototype,{_init:function(){var M=this,L=M._widgets=[];F.each(E,function(O,N){L.push(new N(M))});return I.apply(M,arguments)},request:function(T,S,W){var L=0,O=this._widgets,V=O.length,M=[],U=[],P,R,Q,N;S=D(S)?S:[S];for(;L<V;L++){P=O[L];R=P.invoke(T,S);if(R!==K){if(J.isPromise(R)){U.push(R)}else{M.push(R)}}}if(W||U.length){Q=J.when.apply(J,U);N=Q.pipe?"pipe":"then";return Q[N](function(){var Y=J.Deferred(),X=arguments;if(X.length===1){X=X[0]}setTimeout(function(){Y.resolve(X)},1);return Y.promise()})[W?N:"done"](W||J.noop)}else{return M[0]}}});H.register=G.register=function(N,M){var O={init:"init"},L;if(arguments.length===1){M=N;M.responseMap=O}else{M.responseMap=F.extend(O,N)}L=J.inherits(G,M);E.push(L);return L};return G});A("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(D,F,G){var E=D.$;F.options.dnd="";return F.register({init:function(H){if(!H.dnd||this.request("predict-runtime-type")!=="html5"){return}var L=this,K=D.Deferred(),J=E.extend({},{disableGlobalDnd:H.disableGlobalDnd,container:H.dnd,accept:H.accept}),I;I=new G(J);I.once("ready",K.resolve);I.on("drop",function(M){L.request("add-file",[M])});I.on("accept",function(M){return L.owner.trigger("dndAccept",M)});I.init();return K.promise()}})});A("lib/filepaste",["base","mediator","runtime/client"],function(D,H,G){var F=D.$;function E(I){I=this.options=F.extend({},I);I.container=F(I.container||document.body);G.call(this,"FilePaste")}D.inherits(G,{constructor:E,init:function(){var I=this;I.connectRuntime(I.options,function(){I.exec("init");I.trigger("ready")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}});H.installTo(E.prototype);return E});A("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(D,G,E){var F=D.$;return G.register({init:function(H){if(!H.paste||this.request("predict-runtime-type")!=="html5"){return}var L=this,J=D.Deferred(),I=F.extend({},{container:H.paste,accept:H.accept}),K;K=new E(I);K.once("ready",J.resolve);K.on("paste",function(M){L.owner.request("add-file",[M])});K.init();return J.promise()}})});A("lib/blob",["base","runtime/client"],function(D,F){function E(G,H){var I=this;I.source=H;I.ruid=G;this.size=H.size||0;if(!H.type&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)){this.type="image/"+(this.ext==="jpg"?"jpeg":this.ext)}else{this.type=H.type||"application/octet-stream"}F.call(I,"Blob");this.uid=H.uid||this.uid;if(G){I.connectRuntime(G)}}D.inherits(F,{constructor:E,slice:function(G,H){return this.exec("slice",G,H)},getSource:function(){return this.source}});return E});A("lib/file",["base","lib/blob"],function(E,H){var D=1,F=/\.([^.]+)$/;function G(J,K){var I;this.name=K.name||("untitled"+D++);I=F.exec(K.name)?RegExp.$1.toLowerCase():"";if(!I&&K.type){I=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(K.type)?RegExp.$1.toLowerCase():"";this.name+="."+I}this.ext=I;this.lastModifiedDate=K.lastModifiedDate||(new Date()).toLocaleString();H.apply(this,arguments)}return E.inherits(H,G)});A("lib/filepicker",["base","runtime/client","lib/file"],function(E,G,D){var F=E.$;function H(I){I=this.options=F.extend({},H.options,I);I.container=F(I.id);if(!I.container.length){throw new Error("按钮指定错误")}I.innerHTML=I.innerHTML||I.label||I.container.html()||"";I.button=F(I.button||document.createElement("div"));I.button.html(I.innerHTML);I.container.html(I.button);G.call(this,"FilePicker",true)}H.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};E.inherits(G,{constructor:H,init:function(){var K=this,I=K.options,J=I.button;J.addClass("webuploader-pick");K.on("all",function(L){var M;switch(L){case"mouseenter":J.addClass("webuploader-pick-hover");break;case"mouseleave":J.removeClass("webuploader-pick-hover");break;case"change":M=K.exec("getFiles");K.trigger("select",F.map(M,function(N){N=new D(K.getRuid(),N);N._refer=I.container;return N}),I.container);break}});K.connectRuntime(I,function(){K.refresh();K.exec("init",I);K.trigger("ready")});F(C).on("resize",function(){K.refresh()})},refresh:function(){var L=this.getRuntime().getContainer(),M=this.options.button,K=M.outerWidth?M.outerWidth():M.width(),J=M.outerHeight?M.outerHeight():M.height(),I=M.offset();K&&J&&L.css({bottom:"auto",right:"auto",width:K+"px",height:J+"px"}).offset(I)},enable:function(){var I=this.options.button;I.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var I=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});I.addClass("webuploader-pick-disable")},destroy:function(){if(this.runtime){this.exec("destroy");this.disconnectRuntime()}}});return H});A("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(D,F,G){var E=D.$;E.extend(F.options,{pick:null,accept:null});return F.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(H){this.pickers=[];return H.pick&&this.addButton(H.pick)},refresh:function(){E.each(this.pickers,function(){this.refresh()})},addButton:function(I){var L=this,H=L.options,K=H.accept,J=[];if(!I){return}E.isPlainObject(I)||(I={id:I});E(I.id).each(function(){var M,O,N;N=D.Deferred();M=E.extend({},I,{accept:E.isPlainObject(K)?[K]:K,swf:H.swf,runtimeOrder:H.runtimeOrder,id:this});O=new G(M);O.once("ready",N.resolve);O.on("select",function(P){L.owner.request("add-file",[P])});O.init();L.pickers.push(O);J.push(N.promise())});return D.when.apply(D,J)},disable:function(){E.each(this.pickers,function(){this.disable()})},enable:function(){E.each(this.pickers,function(){this.enable()})}})});A("lib/image",["base","runtime/client","lib/blob"],function(D,H,E){var F=D.$;function G(I){this.options=F.extend({},G.options,I);H.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}G.options={quality:90,crop:false,preserveHeaders:false,allowMagnify:false};D.inherits(H,{constructor:G,info:function(I){if(I){this._info=I;return this}return this._info},meta:function(I){if(I){this._meta=I;return this}return this._meta},loadFromBlob:function(J){var K=this,I=J.getRuid();this.connectRuntime(I,function(){K.exec("init",K.options);K.exec("loadFromBlob",J)})},resize:function(){var I=D.slice(arguments);return this.exec.apply(this,["resize"].concat(I))},crop:function(){var I=D.slice(arguments);return this.exec.apply(this,["crop"].concat(I))},getAsDataUrl:function(I){return this.exec("getAsDataUrl",I)},getAsBlob:function(I){var J=this.exec("getAsBlob",I);return new E(this.getRuid(),J)}});return G});A("widgets/image",["base","uploader","lib/image","widgets/widget"],function(D,F,G){var E=D.$,H;H=(function(L){var J=0,K=[],I=function(){var M;while(K.length&&J<L){M=K.shift();J+=M[0];M[1]()}};return function(O,M,N){K.push([M,N]);O.once("destroy",function(){J-=M;setTimeout(I,1)});setTimeout(I,1)}})(5*1024*1024);E.extend(F.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return F.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(N,I,K,J){var L,M;N=this.request("get-file",N);if(!N.type.match(/^image/)){I(true);return}L=E.extend({},this.options.thumb);if(E.isPlainObject(K)){L=E.extend(L,K);K=null}K=K||L.width;J=J||L.height;M=new G(L);M.once("load",function(){N._info=N._info||M.info();N._meta=N._meta||M.meta();if(K<=1&&K>0){K=N._info.width*K}if(J<=1&&J>0){J=N._info.height*J}M.resize(K,J)});M.once("complete",function(){I(false,M.getAsDataUrl(L.type));M.destroy()});M.once("error",function(O){I(O||true);M.destroy()});H(M,N.source.size,function(){N._info&&M.info(N._info);N._meta&&M.meta(N._meta);M.loadFromBlob(N.source)})},compressImage:function(N){var I=this.options.compress||this.options.resize,J=I&&I.compressSize||0,K=I&&I.noCompressIfLarger||false,M,L;N=this.request("get-file",N);if(!I||!~"image/jpeg,image/jpg".indexOf(N.type)||N.size<J||N._compressed){return}I=E.extend({},I);L=D.Deferred();M=new G(I);L.always(function(){M.destroy();M=null});M.once("error",L.reject);M.once("load",function(){var P=I.width,O=I.height;N._info=N._info||M.info();N._meta=N._meta||M.meta();if(P<=1&&P>0){P=N._info.width*P}if(O<=1&&O>0){O=N._info.height*O}M.resize(P,O)});M.once("complete",function(){var Q,O;try{Q=M.getAsBlob(I.type);O=N.size;if(!K||Q.size<O){N.source=Q;N.size=Q.size;N.trigger("resize",Q.size,O)}N._compressed=true;L.resolve()}catch(P){L.resolve()}});N._info&&M.info(N._info);N._meta&&M.meta(N._meta);M.loadFromBlob(N.source);return L.promise()}})});A("file",["base","mediator"],function(F,G){var E=F.$,L="WU_FILE_",K=0,D=/\.([^.]+)$/,I={};function H(){return L+K++}function J(N){this.name=N.name||"Untitled";this.size=N.size||0;var M;try{M=N.source.fullPath}catch(O){}this.fullPath=M;this.type=N.type||"application";this.lastModifiedDate=N.lastModifiedDate||(new Date()*1);this.id=H();this.ext=D.exec(this.name)?RegExp.$1:"";this.statusText="";I[this.id]=J.Status.INITED;this.source=N;this.loaded=0;this.on("error",function(P){this.setStatus(J.Status.ERROR,P)})}E.extend(J.prototype,{setStatus:function(M,O){var N=I[this.id];typeof O!=="undefined"&&(this.statusText=O);if(M!==N){I[this.id]=M;this.trigger("statuschange",M,N)}},getStatus:function(){return I[this.id]},getSource:function(){return this.source},destory:function(){delete I[this.id]}});G.installTo(J.prototype);J.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return J});A("queue",["base","mediator","file"],function(E,I,H){var G=E.$,F=H.Status;function D(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}G.extend(D.prototype,{append:function(J){this._queue.push(J);this._fileAdded(J);return this},prepend:function(J){this._queue.unshift(J);this._fileAdded(J);return this},getFile:function(J){if(typeof J!=="string"){return J}return this._map[J]},fetch:function(K){var J=this._queue.length,L,M;K=K||F.QUEUED;for(L=0;L<J;L++){M=this._queue[L];if(K===M.getStatus()){return M}}return null},sort:function(J){if(typeof J==="function"){this._queue.sort(J)}},getFiles:function(){var M=[].slice.call(arguments,0),N=[],L=0,J=this._queue.length,K;for(;L<J;L++){K=this._queue[L];if(M.length&&!~G.inArray(K.getStatus(),M)){continue}N.push(K)}return N},_fileAdded:function(L){var J=this,K=this._map[L.id];if(!K){this._map[L.id]=L;L.on("statuschange",function(N,M){J._onFileStatusChange(N,M)})}L.setStatus(F.QUEUED)},_onFileStatusChange:function(L,K){var J=this.stats;switch(K){case F.PROGRESS:J.numOfProgress--;break;case F.QUEUED:J.numOfQueue--;break;case F.ERROR:J.numOfUploadFailed--;break;case F.INVALID:J.numOfInvalid--;break}switch(L){case F.QUEUED:J.numOfQueue++;break;case F.PROGRESS:J.numOfProgress++;break;case F.ERROR:J.numOfUploadFailed++;break;case F.COMPLETE:J.numOfSuccess++;break;case F.CANCELLED:J.numOfCancel++;break;case F.INVALID:J.numOfInvalid++;break}}});I.installTo(D.prototype);return D});A("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(K,E,G,J,L,D){var H=K.$,I=/\.\w+$/,F=J.Status;return E.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile","retry":"retry","reset":"reset","accept-file":"acceptFile"},{init:function(U){var R=this,Q,S,M,O,P,T,N;if(H.isPlainObject(U.accept)){U.accept=[U.accept]}if(U.accept){P=[];for(M=0,S=U.accept.length;M<S;M++){O=U.accept[M].extensions;O&&P.push(O)}if(P.length){T="\\."+P.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}R.accept=new RegExp(T,"i")}R.queue=new G();R.stats=R.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}Q=K.Deferred();N=new D("Placeholder");N.connectRuntime({runtimeOrder:"html5"},function(){R._ruid=N.getRuid();Q.resolve()});return Q.promise()},_wrapFile:function(M){if(!(M instanceof J)){if(!(M instanceof L)){if(!this._ruid){throw new Error("Can't add external files.")}M=new L(this._ruid,M)}M=new J(M)}return M},acceptFile:function(N){var M=!N||this.accept&&I.exec(N.name)&&!this.accept.test(N.name);return !M},_addFile:function(N){var M=this;N=M._wrapFile(N);if(!M.owner.trigger("beforeFileQueued",N)){return}if(!M.acceptFile(N)){M.owner.trigger("error","Q_TYPE_DENIED",N);return}M.queue.append(N);M.owner.trigger("fileQueued",N);return N},getFile:function(M){return this.queue.getFile(M)},addFiles:function(M){var N=this;if(!M.length){M=[M]}M=H.map(M,function(O){return N._addFile(O)});N.owner.trigger("filesQueued",M);if(N.options.auto){setTimeout(function(){N.request("start-upload")},20)}},getStats:function(){return this.stats},removeFile:function(N){var M=this;N=N.id?N:M.queue.getFile(N);N.setStatus(F.CANCELLED);M.owner.trigger("fileDequeued",N)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(R,M){var N=this,P,Q,O;if(R){R=R.id?R:N.queue.getFile(R);R.setStatus(F.QUEUED);M||N.request("start-upload");return}P=N.queue.getFiles(F.ERROR);Q=0;O=P.length;for(;Q<O;Q++){R=P[Q];R.setStatus(F.QUEUED)}N.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new G();this.stats=this.queue.stats}})});A("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(D,E){D.support=function(){return E.hasRuntime.apply(E,arguments)};return D.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType()){throw Error("Runtime Error")}},predictRuntmeType:function(){var G=this.options.runtimeOrder||E.orders,H=this.type,I,F;if(!H){G=G.split(/\s*,\s*/g);for(I=0,F=G.length;I<F;I++){if(E.hasRuntime(G[I])){this.type=H=G[I];break}}}return H}})});A("lib/transport",["base","runtime/client","mediator"],function(E,H,G){var F=E.$;function D(I){var J=this;I=J.options=F.extend(true,{},D.options,I||{});H.call(this,"Transport");this._blob=null;this._formData=I.formData||{};this._headers=I.headers||{};this.on("progress",this._timeout);this.on("load error",function(){J.trigger("progress",1);clearTimeout(J._timer)})}D.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1000,formData:{},headers:{},sendAsBinary:false};F.extend(D.prototype,{appendBlob:function(J,L,K){var M=this,I=M.options;if(M.getRuid()){M.disconnectRuntime()}M.connectRuntime(L.ruid,function(){M.exec("init")});M._blob=L;I.fileVal=J||I.fileVal;I.filename=K||I.filename},append:function(J,I){if(typeof J==="object"){F.extend(this._formData,J)}else{this._formData[J]=I}},setRequestHeader:function(J,I){if(typeof J==="object"){F.extend(this._headers,J)}else{this._headers[J]=I}},send:function(I){this.exec("send",I);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var J=this,I=J.options.timeout;if(!I){return}clearTimeout(J._timer);J._timer=setTimeout(function(){J.abort();J.trigger("error","timeout")},I)}});G.installTo(D.prototype);return D});A("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(J,D,I,K){var F=J.$,G=J.isPromise,E=I.Status;F.extend(D.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:null});function H(R,T){var Q=[],N=R.source,P=N.size,L=T?Math.ceil(P/T):1,S=0,O=0,M;while(O<L){M=Math.min(T,P-S);Q.push({file:R,start:S,end:T?(S+M):P,total:P,chunks:L,chunk:O++});S+=M}R.blocks=Q.concat();R.remaning=Q.length;return{file:R,has:function(){return !!Q.length},fetch:function(){return Q.shift()}}}D.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var L=this.owner;this.runing=false;this.pool=[];this.pending=[];this.remaning=0;this.__tick=J.bindFn(this._tick,this);L.on("uploadComplete",function(M){M.blocks&&F.each(M.blocks,function(O,N){N.transport&&(N.transport.abort(),N.transport.destroy());delete N.transport});delete M.blocks;delete M.remaning})},start:function(){var L=this;F.each(L.request("get-files",E.INVALID),function(){L.request("remove-file",this)});if(L.runing){return}L.runing=true;F.each(L.pool,function(N,M){var O=M.file;if(O.getStatus()===E.INTERRUPT){O.setStatus(E.PROGRESS);L._trigged=false;M.transport&&M.transport.send()}});L._trigged=false;L.owner.trigger("startUpload");J.nextTick(L.__tick)},stop:function(M){var L=this;if(L.runing===false){return}L.runing=false;M&&F.each(L.pool,function(O,N){N.transport&&N.transport.abort();N.file.setStatus(E.INTERRUPT)});L.owner.trigger("stopUpload")},isInProgress:function(){return !!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(M,L){M=this.request("get-file",M);M.setStatus(L||E.COMPLETE);M.skipped=true;M.blocks&&F.each(M.blocks,function(P,O){var N=O.transport;if(N){N.abort();N.destroy();delete O.transport}});this.owner.trigger("uploadSkip",M)},_tick:function(){var O=this,L=O.options,M,N;if(O._promise){return O._promise.always(O.__tick)}if(O.pool.length<L.threads&&(N=O._nextBlock())){O._trigged=false;M=function(P){O._promise=null;P&&P.file&&O._startSend(P);J.nextTick(O.__tick)};O._promise=G(N)?N.always(M):M(N)}else{if(!O.remaning&&!O.getStats().numOfQueue){O.runing=false;O._trigged||J.nextTick(function(){O.owner.trigger("uploadFinished")});O._trigged=true}}},_nextBlock:function(){var P=this,N=P._act,L=P.options,O,M;if(N&&N.has()&&N.file.getStatus()===E.PROGRESS){if(L.prepareNextFile&&!P.pending.length){P._prepareNextFile()}return N.fetch()}else{if(P.runing){if(!P.pending.length&&P.getStats().numOfQueue){P._prepareNextFile()}O=P.pending.shift();M=function(Q){if(!Q){return null}N=H(Q,L.chunked?L.chunkSize:0);P._act=N;return N.fetch()};return G(O)?O[O.pipe?"pipe":"then"](M):M(O)}}},_prepareNextFile:function(){var O=this,N=O.request("fetch-file"),M=O.pending,L;if(N){L=O.request("before-send-file",N,function(){if(N.getStatus()===E.QUEUED){O.owner.trigger("uploadStart",N);N.setStatus(E.PROGRESS);return N}return O._finishFile(N)});L.done(function(){var P=F.inArray(L,M);~P&&M.splice(P,1,N)});L.fail(function(P){N.setStatus(E.ERROR,P);O.owner.trigger("uploadError",N,P);O.owner.trigger("uploadComplete",N)});M.push(L)}},_popBlock:function(L){var M=F.inArray(L,this.pool);this.pool.splice(M,1);L.file.remaning--;this.remaning--},_startSend:function(M){var O=this,N=M.file,L;O.pool.push(M);O.remaning++;M.blob=M.chunks===1?N.source:N.source.slice(M.start,M.end);L=O.request("before-send",M,function(){if(N.getStatus()===E.PROGRESS){O._doSend(M)}else{O._popBlock(M);J.nextTick(O.__tick)}});L.fail(function(){if(N.remaning===1){O._finishFile(N).always(function(){M.percentage=1;O._popBlock(M);O.owner.trigger("uploadComplete",N);J.nextTick(O.__tick)})}else{M.percentage=1;O._popBlock(M);J.nextTick(O.__tick)}})},_doSend:function(L){var Q=this,O=Q.owner,U=Q.options,P=L.file,R=new K(U),N=F.extend({},U.formData),S=F.extend({},U.headers),T,M;L.transport=R;R.on("destroy",function(){delete L.transport;Q._popBlock(L);J.nextTick(Q.__tick)});R.on("progress",function(X){var V=0,W=0;V=L.percentage=X;if(L.chunks>1){F.each(P.blocks,function(Z,Y){W+=(Y.percentage||0)*(Y.end-Y.start)});V=W/P.size}O.trigger("uploadProgress",P,V||0)});T=function(W){var V;M=R.getResponseAsJson()||{};M._raw=R.getResponse();V=function(X){W=X};if(!O.trigger("uploadAccept",L,M,V)){W=W||"server"}return W};R.on("error",function(V,W){L.retried=L.retried||0;if(L.chunks>1&&~"http,abort".indexOf(V)&&L.retried<U.chunkRetry){L.retried++;R.send()}else{if(!W&&V==="server"){V=T(V)}P.setStatus(E.ERROR,V);O.trigger("uploadError",P,V);O.trigger("uploadComplete",P)}});R.on("load",function(){var V;if((V=T())){R.trigger("error",V,true);return}if(P.remaning===1){Q._finishFile(P,M)}else{R.destroy()}});N=F.extend(N,{id:P.id,name:P.name,type:P.type,lastModifiedDate:P.lastModifiedDate,size:P.size});L.chunks>1&&F.extend(N,{chunks:L.chunks,chunk:L.chunk});O.trigger("uploadBeforeSend",L,N,S);R.appendBlob(U.fileVal,L.blob,P.name);R.append(N);R.setRequestHeader(S);R.send()},_finishFile:function(O,N,M){var L=this.owner;return L.request("after-send-file",arguments,function(){O.setStatus(E.COMPLETE);L.trigger("uploadSuccess",O,N,M)}).fail(function(P){if(O.getStatus()===E.PROGRESS){O.setStatus(E.ERROR,P)}L.trigger("uploadError",O,P)}).always(function(){L.trigger("uploadComplete",O)})}})});A("widgets/validator",["base","uploader","file","widgets/widget"],function(E,G,H){var F=E.$,I={},D;D={addValidator:function(K,J){I[K]=J},removeValidator:function(J){delete I[J]}};G.register({init:function(){var J=this;E.nextTick(function(){F.each(I,function(){this.call(J.owner)})})}});D.addValidator("fileNumLimit",function(){var L=this,J=L.options,N=0,M=parseInt(J.fileNumLimit,10),K=true;if(!M){return}L.on("beforeFileQueued",function(O){if(N>=M&&K){K=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",M,O);setTimeout(function(){K=true},1)}return N>=M?false:true});L.on("fileQueued",function(){N++});L.on("fileDequeued",function(){N--});L.on("uploadFinished reset",function(){N=0})});D.addValidator("fileSizeLimit",function(){var L=this,J=L.options,N=0,M=J.fileSizeLimit>>0,K=true;if(!M){return}L.on("beforeFileQueued",function(P){var O=N+P.size>M;if(O&&K){K=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",M,P);setTimeout(function(){K=true},1)}return O?false:true});L.on("fileQueued",function(O){N+=O.size});L.on("fileDequeued",function(O){N-=O.size});L.on("uploadFinished reset",function(){N=0})});D.addValidator("fileSingleSizeLimit",function(){var K=this,J=K.options,L=J.fileSingleSizeLimit;if(!L){return}K.on("beforeFileQueued",function(M){if(M.size>L){M.setStatus(H.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",M);return false}})});D.addValidator("duplicate",function(){var L=this,J=L.options,M={};if(J.duplicate){return}function K(P){var O=0,Q=0,N=P.length,R;for(;Q<N;Q++){R=P.charCodeAt(Q);O=R+(O<<6)+(O<<16)-O}return O}L.on("beforeFileQueued",function(O){var N=O.__hash||(O.__hash=K(O.name+O.size+O.lastModifiedDate));if(M[N]){this.trigger("error","F_DUPLICATE",O);return false}});L.on("fileQueued",function(O){var N=O.__hash;N&&(M[N]=true)});L.on("fileDequeued",function(O){var N=O.__hash;N&&(delete M[N])});L.on("reset",function(){M={}})});return D});A("lib/md5",["runtime/client","mediator"],function(F,E){function D(){F.call(this,"Md5")}E.installTo(D.prototype);D.prototype.loadFromBlob=function(G){var H=this;if(H.getRuid()){H.disconnectRuntime()}H.connectRuntime(G.ruid,function(){H.exec("init");H.exec("loadFromBlob",G)})};D.prototype.getResult=function(){return this.exec("getResult")};return D});A("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(E,F,D,G){return F.register({"md5-file":"md5Blob"},{md5Blob:function(M,I,J){var H=new D(),K=E.Deferred(),L=(M instanceof G)?M:this.request("get-file",M).source;H.on("progress load",function(N){N=N||{};K.notify(N.total?N.loaded/N.total:1)});H.on("complete",function(){K.resolve(H.getResult())});H.on("error",function(N){K.reject(N)});if(arguments.length>1){I=I||0;J=J||0;I<0&&(I=L.size+I);J<0&&(J=L.size+J);J=Math.min(J,L.size);L=L.slice(I,J)}H.loadFromBlob(L);return K.promise()}})});A("runtime/compbase",[],function(){function D(E,F){this.owner=E;this.options=E.options;this.getRuntime=function(){return F};this.getRuid=function(){return F.uid};this.trigger=function(){return E.trigger.apply(E,arguments)}}return D});A("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(E,G,H){var I="html5",F={};function D(){var J={},L=this,K=this.destory;G.apply(L,arguments);L.type=I;L.exec=function(R,M){var Q=this,O=Q.uid,N=E.slice(arguments,2),P;if(F[R]){P=J[O]=J[O]||new F[R](Q,L);if(P[M]){return P[M].apply(P,N)}}};L.destory=function(){return K&&K.apply(this,arguments)}}E.inherits(G,{constructor:D,init:function(){var J=this;setTimeout(function(){J.trigger("ready")},1)}});D.register=function(J,L){var K=F[J]=E.inherits(H,L);return K};if(C.Blob&&C.FileReader&&C.DataView){G.addRuntime(I,D)}return D});A("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(D,E){return D.register("Blob",{slice:function(F,G){var I=this.owner.source,H=I.slice||I.webkitSlice||I.mozSlice;I=H.call(I,F,G);return new E(this.getRuid(),I)}})});A("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(F,E,D){var H=F.$,G="webuploader-dnd-";return E.register("DragAndDrop",{init:function(){var I=this.elem=this.options.container;this.dragEnterHandler=F.bindFn(this._dragEnterHandler,this);this.dragOverHandler=F.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=F.bindFn(this._dragLeaveHandler,this);this.dropHandler=F.bindFn(this._dropHandler,this);this.dndOver=false;I.on("dragenter",this.dragEnterHandler);I.on("dragover",this.dragOverHandler);I.on("dragleave",this.dragLeaveHandler);I.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){H(document).on("dragover",this.dragOverHandler);H(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(K){dragEnter(K);var L=this,I=L._denied||false,J;K=K.originalEvent||K;if(!L.dndOver){L.dndOver=true;J=K.dataTransfer.items;if(J&&J.length){L._denied=I=!L.trigger("accept",J)}L.elem.addClass(G+"over");L.elem[I?"addClass":"removeClass"](G+"denied")}K.dataTransfer.dropEffect=I?"none":"copy";return false},_dragOverHandler:function(J){dragOver(J);var I=this.elem.parent().get(0);if(I&&!H.contains(I,J.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,J);return false},_dragLeaveHandler:function(){dragLeave();var J=this,I;I=function(){J.dndOver=false;J.elem.removeClass(G+"over "+G+"denied")};clearTimeout(J._leaveTimer);J._leaveTimer=setTimeout(I,100);return false},_dropHandler:function(M){dragDrop(M);var O=this,L=O.getRuid(),K=O.elem.parent().get(0),J,I;if(K&&!H.contains(K,M.currentTarget)){return false}M=M.originalEvent||M;J=M.dataTransfer;try{I=J.getData("text/html")}catch(N){}if(I){return}O._getTansferFiles(J,function(P){O.trigger("drop",H.map(P,function(Q){return new D(L,Q)}))});O.dndOver=false;O.elem.removeClass(G+"over");return false},_getTansferFiles:function(N,S){var M=[],L=[],J,O,P,K,I,Q,R;J=N.items;O=N.files;if(O.length==0){return}R=!!(J&&J[0].webkitGetAsEntry);for(I=0,Q=O.length;I<Q;I++){P=O[I];K=J&&J[I];if(R&&K.webkitGetAsEntry().isDirectory){L.push(this._traverseDirectoryTree(K.webkitGetAsEntry(),M))}else{M.push(P)}}F.when.apply(F,L).done(function(){if(!M.length){return}S(M)})},_traverseDirectoryTree:function(I,K){var J=F.Deferred(),L=this;if(I.isFile){I.file(function(M){M.fullPath=I.fullPath;K.push(M);J.resolve()})}else{if(I.isDirectory){I.createReader().readEntries(function(N){var M=N.length,P=[],O=[],Q;for(Q=0;Q<M;Q++){P.push(L._traverseDirectoryTree(N[Q],O))}F.when.apply(F,P).then(function(){K.push.apply(K,O);J.resolve()},J.reject)})}}return J.promise()},destroy:function(){var I=this.elem;I.off("dragenter",this.dragEnterHandler);I.off("dragover",this.dragEnterHandler);I.off("dragleave",this.dragLeaveHandler);I.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){H(document).off("dragover",this.dragOverHandler);H(document).off("drop",this.dropHandler)}}})});A("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(F,E,D){return E.register("FilePaste",{init:function(){var G=this.options,K=this.elem=G.container,M=".*",I,L,J,H;if(G.accept){I=[];for(L=0,J=G.accept.length;L<J;L++){H=G.accept[L].mimeTypes;H&&I.push(H)}if(I.length){M=I.join(",");M=M.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=M=new RegExp(M,"i");this.hander=F.bindFn(this._pasteHander,this);K.on("paste",this.hander)},_pasteHander:function(K){var N=[],H=this.getRuid(),I,J,G,L,M;K=K.originalEvent||K;I=K.clipboardData.items;for(L=0,M=I.length;L<M;L++){J=I[L];if(J.kind!=="file"||!(G=J.getAsFile())){continue}N.push(new D(H,G))}if(N.length){K.preventDefault();K.stopPropagation();this.trigger("paste",N)}},destroy:function(){this.elem.off("paste",this.hander)}})});A("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(E,D){var F=E.$;return D.register("FilePicker",{init:function(){var H=this.getRuntime().getContainer(),N=this,J=N.owner,P=N.options,L=F(document.createElement("label")),M=F(document.createElement("input")),K,G,O,I;M.attr("type","file");M.attr("name",P.name);M.addClass("webuploader-element-invisible");L.on("click",function(){M.trigger("click")});L.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(P.multiple){M.attr("multiple","multiple")}if(P.accept&&P.accept.length>0){K=[];for(G=0,O=P.accept.length;G<O;G++){K.push(P.accept[G].mimeTypes)}M.attr("accept",K.join(","))}H.append(M);H.append(L);I=function(Q){J.trigger(Q.type)};M.on("change",function(R){var Q=arguments.callee,S;N.files=R.target.files;S=this.cloneNode(true);S.value=null;this.parentNode.replaceChild(S,this);M.off();M=F(S).on("change",Q).on("mouseenter mouseleave",I);J.trigger("change")});L.on("mouseenter mouseleave",I)},getFiles:function(){return this.files},destroy:function(){}})});A("runtime/html5/util",["base"],function(E){var F=C.createObjectURL&&C||C.URL&&URL.revokeObjectURL&&URL||C.webkitURL,G=E.noop,D=G;if(F){G=function(){return F.createObjectURL.apply(F,arguments)};D=function(){return F.revokeObjectURL.apply(F,arguments)}}return{createObjectURL:G,revokeObjectURL:D,dataURL2Blob:function(K){var M,H,N,L,J,I;I=K.split(",");if(~I[0].indexOf("base64")){M=atob(I[1])}else{M=decodeURIComponent(I[1])}N=new ArrayBuffer(M.length);H=new Uint8Array(N);for(L=0;L<M.length;L++){H[L]=M.charCodeAt(L)}J=I[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(N,J)},dataURL2ArrayBuffer:function(I){var K,H,J,L;L=I.split(",");if(~L[0].indexOf("base64")){K=atob(L[1])}else{K=decodeURIComponent(L[1])}H=new Uint8Array(K.length);for(J=0;J<K.length;J++){H[J]=K.charCodeAt(J)}return H.buffer},arrayBufferToBlob:function(J,I){var H=C.BlobBuilder||C.WebKitBlobBuilder,K;if(H){K=new H();K.append(J);return K.getBlob(I)}return new Blob([J],I?{type:I}:{})},canvasToDataUrl:function(J,H,I){return J.toDataURL(H,I/100)},parseMeta:function(H,I){I(false,{})},updateImageHead:function(H){return H}}});A("runtime/html5/imagemeta",["runtime/html5/util"],function(D){var E;E={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(H,F){var I=this,G=new FileReader();G.onload=function(){F(false,I._parse(this.result));G=G.onload=G.onerror=null};G.onerror=function(J){F(J.message);G=G.onload=G.onerror=null};H=H.slice(0,I.maxMetaDataSize);G.readAsArrayBuffer(H.getSource())},_parse:function(H,J){if(H.byteLength<6){return}var N=new DataView(H),P=2,M=N.byteLength-4,L=P,G={},K,O,F,I;if(N.getUint16(0)===65496){while(P<M){K=N.getUint16(P);if(K>=65504&&K<=65519||K===65534){O=N.getUint16(P+2)+2;if(P+O>N.byteLength){break}F=E.parsers[K];if(!J&&F){for(I=0;I<F.length;I+=1){F[I].call(E,N,P,O,G)}}P+=O;L=P}else{break}}if(L>6){if(H.slice){G.imageHead=H.slice(2,L)}else{G.imageHead=new Uint8Array(H).subarray(2,L)}}}return G},updateImageHead:function(G,F){var K=this._parse(G,true),I,H,J;J=2;if(K.imageHead){J=2+K.imageHead.byteLength}if(G.slice){H=G.slice(J)}else{H=new Uint8Array(G).subarray(J)}I=new Uint8Array(F.byteLength+2+H.byteLength);I[0]=255;I[1]=216;I.set(new Uint8Array(F),2);I.set(new Uint8Array(H),F.byteLength+2);return I.buffer}};D.parseMeta=function(){return E.parse.apply(E,arguments)};D.updateImageHead=function(){return E.updateImageHead.apply(E,arguments)};return E});A("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(E,D){var F={};F.ExifMap=function(){return this};F.ExifMap.prototype.map={"Orientation":274};F.ExifMap.prototype.get=function(G){return this[G]||this[this.map[G]]};F.exifTagTypes={1:{getValue:function(H,G){return H.getUint8(G)},size:1},2:{getValue:function(H,G){return String.fromCharCode(H.getUint8(G))},size:1,ascii:true},3:{getValue:function(I,G,H){return I.getUint16(G,H)},size:2},4:{getValue:function(I,G,H){return I.getUint32(G,H)},size:4},5:{getValue:function(I,G,H){return I.getUint32(G,H)/I.getUint32(G+4,H)},size:8},9:{getValue:function(I,G,H){return I.getInt32(G,H)},size:4},10:{getValue:function(I,G,H){return I.getInt32(G,H)/I.getInt32(G+4,H)},size:8}};F.exifTagTypes[7]=F.exifTagTypes[1];F.getExifValue=function(H,S,G,I,Q,J){var K=F.exifTagTypes[I],R,P,O,M,N,L;if(!K){E.log("Invalid Exif data: Invalid tag type.");return}R=K.size*Q;P=R>4?S+H.getUint32(G+8,J):(G+8);if(P+R>H.byteLength){E.log("Invalid Exif data: Invalid data offset.");return}if(Q===1){return K.getValue(H,P,J)}O=[];for(M=0;M<Q;M+=1){O[M]=K.getValue(H,P+M*K.size,J)}if(K.ascii){N="";for(M=0;M<O.length;M+=1){L=O[M];if(L==="\u0000"){break}N+=L}return N}return O};F.parseExifTag=function(K,J,I,H,L){var G=K.getUint16(I,H);L.exif[G]=F.getExifValue(K,J,I,K.getUint16(I+2,H),K.getUint32(I+4,H),H)};F.parseExifTags=function(I,N,L,J,K){var M,H,G;if(L+6>I.byteLength){E.log("Invalid Exif data: Invalid directory offset.");return}M=I.getUint16(L,J);H=L+2+12*M;if(H+4>I.byteLength){E.log("Invalid Exif data: Invalid directory size.");return}for(G=0;G<M;G+=1){this.parseExifTag(I,N,L+2+12*G,J,K)}return I.getUint32(H,J)};F.parseExifData=function(L,K,H,M){var G=K+10,I,J;if(L.getUint32(K+4)!==1165519206){return}if(G+8>L.byteLength){E.log("Invalid Exif data: Invalid segment size.");return}if(L.getUint16(K+8)!==0){E.log("Invalid Exif data: Missing byte alignment offset.");return}switch(L.getUint16(G)){case 18761:I=true;break;case 19789:I=false;break;default:E.log("Invalid Exif data: Invalid byte alignment marker.");return}if(L.getUint16(G+2,I)!==42){E.log("Invalid Exif data: Missing TIFF marker.");return}J=L.getUint32(G+4,I);M.exif=new F.ExifMap();J=F.parseExifTags(L,G,G+J,I,M)};D.parsers[65505].push(F.parseExifData);return F});A("runtime/html5/jpegencoder",[],function(E,F,D){function G(V){var q=this;var r=Math.round;var w=Math.floor;var L=new Array(64);var Ag=new Array(64);var I=new Array(64);var Af=new Array(64);var y;var J;var Z;var T;var Ab=new Array(65535);var H=new Array(65535);var X=new Array(64);var x=new Array(64);var Y=[];var K=0;var M=7;var f=new Array(64);var o=new Array(64);var p=new Array(64);var v=new Array(256);var Q=new Array(2048);var O;var m=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var t=[0,1,2,3,4,5,6,7,8,9,10,11];var W=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var Ad=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var u=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var z=[0,1,2,3,4,5,6,7,8,9,10,11];var Ac=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var a=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Aa(Ao){var Am=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var Ah=0;Ah<64;Ah++){var Aq=w((Am[Ah]*Ao+50)/100);if(Aq<1){Aq=1}else{if(Aq>255){Aq=255}}L[m[Ah]]=Aq}var Al=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var Ai=0;Ai<64;Ai++){var Ar=w((Al[Ai]*Ao+50)/100);if(Ar<1){Ar=1}else{if(Ar>255){Ar=255}}Ag[m[Ai]]=Ar}var Ak=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var Aj=0;for(var Ap=0;Ap<8;Ap++){for(var An=0;An<8;An++){I[Aj]=(1/(L[m[Aj]]*Ak[Ap]*Ak[An]*8));Af[Aj]=(1/(Ag[m[Aj]]*Ak[Ap]*Ak[An]*8));Aj++}}}function P(An,Am){var Ai=0;var Ah=0;var Ak=new Array();for(var Aj=1;Aj<=16;Aj++){for(var Al=1;Al<=An[Aj];Al++){Ak[Am[Ah]]=[];Ak[Am[Ah]][0]=Ai;Ak[Am[Ah]][1]=Aj;Ah++;Ai++}Ai*=2}return Ak}function h(){y=P(S,t);J=P(u,z);Z=P(W,Ad);T=P(Ac,a)}function N(){var Ah=1;var Ak=2;for(var Ai=1;Ai<=15;Ai++){for(var Aj=Ah;Aj<Ak;Aj++){H[32767+Aj]=Ai;Ab[32767+Aj]=[];Ab[32767+Aj][1]=Ai;Ab[32767+Aj][0]=Aj}for(var Al=-(Ak-1);Al<=-Ah;Al++){H[32767+Al]=Ai;Ab[32767+Al]=[];Ab[32767+Al][1]=Ai;Ab[32767+Al][0]=Ak-1+Al}Ah<<=1;Ak<<=1}}function s(){for(var Ah=0;Ah<256;Ah++){Q[Ah]=19595*Ah;Q[(Ah+256)>>0]=38470*Ah;Q[(Ah+512)>>0]=7471*Ah+32768;Q[(Ah+768)>>0]=-11059*Ah;Q[(Ah+1024)>>0]=-21709*Ah;Q[(Ah+1280)>>0]=32768*Ah+8421375;Q[(Ah+1536)>>0]=-27439*Ah;Q[(Ah+1792)>>0]=-5329*Ah}}function R(Ai){var Ah=Ai[0];var Aj=Ai[1]-1;while(Aj>=0){if(Ah&(1<<Aj)){K|=(1<<M)}Aj--;M--;if(M<0){if(K==255){c(255);c(0)}else{c(K)}M=7;K=0}}}function c(Ah){Y.push(v[Ah])}function e(Ah){c((Ah>>8)&255);c((Ah)&255)}function g(AJ,AT){var AA,AY,Ay,AX,Aw,An,A4,AS;var Av=0;var AE;var Ai=8;var AG=64;for(AE=0;AE<Ai;++AE){AA=AJ[Av];AY=AJ[Av+1];Ay=AJ[Av+2];AX=AJ[Av+3];Aw=AJ[Av+4];An=AJ[Av+5];A4=AJ[Av+6];AS=AJ[Av+7];var AD=AA+AS;var AL=AA-AS;var A5=AY+A4;var A7=AY-A4;var AI=Ay+An;var AC=Ay-An;var Ao=AX+Aw;var AV=AX-Aw;var AO=AD+Ao;var AN=AD-Ao;var AP=A5+AI;var AM=A5-AI;AJ[Av]=AO+AP;AJ[Av+4]=AO-AP;var AK=(AM+AN)*0.707106781;AJ[Av+2]=AN+AK;AJ[Av+6]=AN-AK;AO=AV+AC;AP=AC+A7;AM=A7+AL;var AH=(AO-AM)*0.382683433;var Aj=0.5411961*AO+AH;var Ah=1.306562965*AM+AH;var At=AP*0.707106781;var A6=AL+At;var AB=AL-At;AJ[Av+5]=AB+Aj;AJ[Av+3]=AB-Aj;AJ[Av+1]=A6+Ah;AJ[Av+7]=A6-Ah;Av+=8}Av=0;for(AE=0;AE<Ai;++AE){AA=AJ[Av];AY=AJ[Av+8];Ay=AJ[Av+16];AX=AJ[Av+24];Aw=AJ[Av+32];An=AJ[Av+40];A4=AJ[Av+48];AS=AJ[Av+56];var Aq=AA+AS;var A3=AA-AS;var A2=AY+A4;var Ax=AY-A4;var A0=Ay+An;var Az=Ay-An;var AF=AX+Aw;var Ak=AX-Aw;var As=Aq+AF;var Au=Aq-AF;var AU=A2+A0;var AR=A2-A0;AJ[Av]=As+AU;AJ[Av+32]=As-AU;var AW=(AR+Au)*0.707106781;AJ[Av+16]=Au+AW;AJ[Av+48]=Au-AW;As=Ak+Az;AU=Az+Ax;AR=Ax+A3;var A1=(As-AR)*0.382683433;var Ar=0.5411961*As+A1;var Ap=1.306562965*AR+A1;var AQ=AU*0.707106781;var Al=A3+AQ;var AZ=A3-AQ;AJ[Av+40]=AZ+Ar;AJ[Av+24]=AZ-Ar;AJ[Av+8]=Al+Ap;AJ[Av+56]=Al-Ap;Av++}var Am;for(AE=0;AE<AG;++AE){Am=AJ[AE]*AT[AE];X[AE]=(Am>0)?((Am+0.5)|0):((Am-0.5)|0)}return X}function i(){e(65504);e(16);c(74);c(70);c(73);c(70);c(0);c(1);c(1);c(0);e(1);e(1);c(0);c(0)}function j(Ai,Ah){e(65472);e(17);c(8);e(Ah);e(Ai);c(3);c(1);c(17);c(0);c(2);c(17);c(1);c(3);c(17);c(1)}function n(){e(65499);e(132);c(0);for(var Ah=0;Ah<64;Ah++){c(L[Ah])}c(1);for(var Ai=0;Ai<64;Ai++){c(Ag[Ai])}}function U(){e(65476);e(418);c(0);for(var Ah=0;Ah<16;Ah++){c(S[Ah+1])}for(var Ai=0;Ai<=11;Ai++){c(t[Ai])}c(16);for(var Aj=0;Aj<16;Aj++){c(W[Aj+1])}for(var Ak=0;Ak<=161;Ak++){c(Ad[Ak])}c(1);for(var Al=0;Al<16;Al++){c(u[Al+1])}for(var Am=0;Am<=11;Am++){c(z[Am])}c(17);for(var An=0;An<16;An++){c(Ac[An+1])}for(var Ao=0;Ao<=161;Ao++){c(a[Ao])}}function l(){e(65498);e(12);c(3);c(1);c(0);c(2);c(17);c(3);c(17);c(0);c(63);c(0)}function d(As,Ao,Ar,Av,Ay){var Au=Ay[0];var Ax=Ay[240];var Az;var At=16;var Aq=63;var AA=64;var Ak=g(As,Ao);for(var An=0;An<AA;++An){x[m[An]]=Ak[An]}var Ap=x[0]-Ar;Ar=x[0];if(Ap==0){R(Av[0])}else{Az=32767+Ap;R(Av[H[Az]]);R(Ab[Az])}var Al=63;for(;(Al>0)&&(x[Al]==0);Al--){}if(Al==0){R(Au);return Ar}var Am=1;var Aw;while(Am<=Al){var Ah=Am;for(;(x[Am]==0)&&(Am<=Al);++Am){}var Aj=Am-Ah;if(Aj>=At){Aw=Aj>>4;for(var Ai=1;Ai<=Aw;++Ai){R(Ax)}Aj=Aj&15}Az=32767+x[Am];R(Ay[(Aj<<4)+H[Az]]);R(Ab[Az]);Am++}if(Al!=Aq){R(Au)}return Ar}function k(){var Ah=String.fromCharCode;for(var Ai=0;Ai<256;Ai++){v[Ai]=Ah(Ai)}}this.encode=function(Ap,Am){if(Am){Ae(Am)}Y=new Array();K=0;M=7;e(65496);i();n();j(Ap.width,Ap.height);U();l();var Ao=0;var An=0;var Az=0;K=0;M=7;this.encode.displayName="_encode_";var At=Ap.data;var AA=Ap.width;var Ak=Ap.height;var Au=AA*4;var Aw=AA*3;var AC,Ah=0;var Al,As,Ar;var Aq,Aj,Ax,Av,AB;while(Ah<Ak){AC=0;while(AC<Au){Aq=Au*Ah+AC;Aj=Aq;Ax=-1;Av=0;for(AB=0;AB<64;AB++){Av=AB>>3;Ax=(AB&7)*4;Aj=Aq+(Av*Au)+Ax;if(Ah+Av>=Ak){Aj-=(Au*(Ah+1+Av-Ak))}if(AC+Ax>=Au){Aj-=((AC+Ax)-Au+4)}Al=At[Aj++];As=At[Aj++];Ar=At[Aj++];f[AB]=((Q[Al]+Q[(As+256)>>0]+Q[(Ar+512)>>0])>>16)-128;o[AB]=((Q[(Al+768)>>0]+Q[(As+1024)>>0]+Q[(Ar+1280)>>0])>>16)-128;p[AB]=((Q[(Al+1280)>>0]+Q[(As+1536)>>0]+Q[(Ar+1792)>>0])>>16)-128}Ao=d(f,I,Ao,y,Z);An=d(o,Af,An,J,T);Az=d(p,Af,Az,J,T);AC+=32}Ah+=8}if(M>=0){var Ay=[];Ay[1]=M+1;Ay[0]=(1<<(M+1))-1;R(Ay)}e(65497);var Ai="data:image/jpeg;base64,"+btoa(Y.join(""));Y=[];return Ai};function Ae(Ah){if(Ah<=0){Ah=1}if(Ah>100){Ah=100}if(O==Ah){return}var Ai=0;if(Ah<50){Ai=Math.floor(5000/Ah)}else{Ai=Math.floor(200-Ah*2)}Aa(Ai);O=Ah}function b(){if(!V){V=50}k();h();N();s();Ae(V)}b()}G.encode=function(J,H){var I=new G(H);return I.encode(J)};return G});A("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(D,G,E){var H=D.canvasToDataUrl,F;D.canvasToDataUrl=function(N,K,I){var M,O,P,J,L;if(!E.os.android){return H.apply(null,arguments)}if(K==="image/jpeg"&&typeof F==="undefined"){J=H.apply(null,arguments);L=J.split(",");if(~L[0].indexOf("base64")){J=atob(L[1])}else{J=decodeURIComponent(L[1])}J=J.substring(0,2);F=J.charCodeAt(0)===255&&J.charCodeAt(1)===216}if(K==="image/jpeg"&&!F){O=N.width;P=N.height;M=N.getContext("2d");return G.encode(M.getImageData(0,0,O,P),I)}return H.apply(null,arguments)}});A("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(E,D,G){var F="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return D.register("Image",{modified:false,init:function(){var I=this,H=new Image();H.onload=function(){I._info={type:I.type,width:this.width,height:this.height};if(!I._metas&&"image/jpeg"===I.type){G.parseMeta(I._blob,function(K,J){I._metas=J;I.owner.trigger("load")})}else{I.owner.trigger("load")}};H.onerror=function(){I.owner.trigger("error")};I._img=H},loadFromBlob:function(I){var J=this,H=J._img;J._blob=I;J.type=I.type;H.src=G.createObjectURL(I.getSource());J.owner.once("load",function(){G.revokeObjectURL(H.src)})},resize:function(I,H){var J=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,J,I,H);this._blob=null;this.modified=true;this.owner.trigger("complete","resize")},crop:function(J,K,Q,R,O){var P=this._canvas||(this._canvas=document.createElement("canvas")),M=this.options,I=this._img,H=I.naturalWidth,L=I.naturalHeight,N=this.getOrientation();O=O||1;P.width=Q;P.height=R;M.preserveHeaders||this._rotate2Orientaion(P,N);this._renderImageToCanvas(P,I,-J,-K,H*O,L*O);this._blob=null;this.modified=true;this.owner.trigger("complete","crop")},getAsBlob:function(I){var K=this._blob,H=this.options,J;I=I||this.type;if(this.modified||this.type!==I){J=this._canvas;if(I==="image/jpeg"){K=G.canvasToDataUrl(J,I,H.quality);if(H.preserveHeaders&&this._metas&&this._metas.imageHead){K=G.dataURL2ArrayBuffer(K);K=G.updateImageHead(K,this._metas.imageHead);K=G.arrayBufferToBlob(K,I);return K}}else{K=G.canvasToDataUrl(J,I)}K=G.dataURL2Blob(K)}return K},getAsDataUrl:function(I){var H=this.options;I=I||this.type;if(I==="image/jpeg"){return G.canvasToDataUrl(this._canvas,I,H.quality)}else{return this._canvas.toDataURL(I)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(H){if(H){this._info=H;return this}return this._info},meta:function(H){if(H){this._meta=H;return this}return this._meta},destroy:function(){var H=this._canvas;this._img.onload=null;if(H){H.getContext("2d").clearRect(0,0,H.width,H.height);H.width=H.height=0;this._canvas=null}this._img.src=F;this._img=this._blob=null},_resize:function(I,R,H,M){var N=this.options,Q=I.width,T=I.height,O=this.getOrientation(),J,S,P,K,L;if(~[5,6,7,8].indexOf(O)){H^=M;M^=H;H^=M}J=Math[N.crop?"max":"min"](H/Q,M/T);N.allowMagnify||(J=Math.min(1,J));S=Q*J;P=T*J;if(N.crop){R.width=H;R.height=M}else{R.width=S;R.height=P}K=(R.width-S)/2;L=(R.height-P)/2;N.preserveHeaders||this._rotate2Orientaion(R,O);this._renderImageToCanvas(R,I,K,L,S,P)},_rotate2Orientaion:function(L,K){var J=L.width,H=L.height,I=L.getContext("2d");switch(K){case 5:case 6:case 7:case 8:L.width=H;L.height=J;break}switch(K){case 2:I.translate(J,0);I.scale(-1,1);break;case 3:I.translate(J,H);I.rotate(Math.PI);break;case 4:I.translate(0,H);I.scale(1,-1);break;case 5:I.rotate(0.5*Math.PI);I.scale(1,-1);break;case 6:I.rotate(0.5*Math.PI);I.translate(0,-H);break;case 7:I.rotate(0.5*Math.PI);I.translate(J,-H);I.scale(-1,1);break;case 8:I.rotate(-0.5*Math.PI);I.translate(-J,0);break}},_renderImageToCanvas:(function(){if(!E.os.ios){return function(L){var J=E.slice(arguments,1),K=L.getContext("2d");K.drawImage.apply(K,J)}}function H(L,T,O){var R=document.createElement("canvas"),Q=R.getContext("2d"),M=0,J=O,K=O,P,N,S;R.width=1;R.height=O;Q.drawImage(L,0,0);P=Q.getImageData(0,0,1,O).data;while(K>M){N=P[(K-1)*4+3];if(N===0){J=K}else{M=K}K=(J+M)>>1}S=(K/O);return(S===0)?1:S}if(E.os.ios>=7){return function(P,J,K,L,Q,O){var R=J.naturalWidth,M=J.naturalHeight,N=H(J,R,M);return P.getContext("2d").drawImage(J,0,0,R*N,M*N,K,L,Q,O)}}function I(K){var J=K.naturalWidth,N=K.naturalHeight,M,L;if(J*N>1024*1024){M=document.createElement("canvas");M.width=M.height=1;L=M.getContext("2d");L.drawImage(K,-J+1,0);return L.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(a,T,e,J,U,O){var Y=T.naturalWidth,K=T.naturalHeight,Q=a.getContext("2d"),L=I(T),Z=this.type==="image/jpeg",X=1024,W=0,V=0,R,N,c,b,P,S,M;if(L){Y/=2;K/=2}Q.save();R=document.createElement("canvas");R.width=R.height=X;N=R.getContext("2d");c=Z?H(T,Y,K):1;b=Math.ceil(X*U/Y);P=Math.ceil(X*O/K/c);while(W<K){S=0;M=0;while(S<Y){N.clearRect(0,0,X,X);N.drawImage(T,-S,-W);Q.drawImage(R,0,0,X,X,e+M,J+V,b,P);S+=X;M+=b}W+=X;V+=P}Q.restore();R=N=null}})()})});A("runtime/html5/transport",["base","runtime/html5/runtime"],function(E,D){var G=E.noop,F=E.$;return D.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var I=this.owner,O=this.options,N=this._initAjax(),H=I._blob,J=O.server,L,K,M;if(O.sendAsBinary){J+=(/\?/.test(J)?"&":"?")+F.param(I._formData);K=H.getSource()}else{L=new FormData();F.each(I._formData,function(Q,P){L.append(Q,P)});L.append(O.fileVal,H.getSource(),O.filename||I._formData.name||"")}if(O.withCredentials&&"withCredentials" in N){N.open(O.method,J,true);N.withCredentials=true}else{N.open(O.method,J)}this._setRequestHeader(N,O.headers);if(K){N.overrideMimeType("application/octet-stream");if(E.os.android){M=new FileReader();M.onload=function(){N.send(this.result);M=M.onload=null};M.readAsArrayBuffer(K)}else{N.send(K)}}else{N.send(L)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var H=this._xhr;if(H){H.upload.onprogress=G;H.onreadystatechange=G;H.abort();this._xhr=H=null}},destroy:function(){this.abort()},_initAjax:function(){var J=this,I=new XMLHttpRequest(),H=this.options;if(H.withCredentials&&!("withCredentials" in I)&&typeof XDomainRequest!=="undefined"){I=new XDomainRequest()}I.upload.onprogress=function(K){var L=0;if(K.lengthComputable){L=K.loaded/K.total}return J.trigger("progress",L)};I.onreadystatechange=function(){if(I.readyState!==4){return}I.upload.onprogress=G;I.onreadystatechange=G;J._xhr=null;J._status=I.status;if(I.status>=200&&I.status<300){J._response=I.responseText;return J.trigger("load")}else{if(I.status>=500&&I.status<600){J._response=I.responseText;return J.trigger("error","server")}}return J.trigger("error",J._status?"http":"abort")};J._xhr=I;return I},_setRequestHeader:function(I,H){F.each(H,function(J,K){I.setRequestHeader(J,K)})},_parseJson:function(I){var H;try{H=JSON.parse(I)}catch(J){H={}}return H}})});A("runtime/html5/md5",["runtime/html5/runtime"],function(M){var G=function(U,V){return(U+V)&4294967295},F=function(Z,W,X,U,Y,V){W=G(G(W,Z),G(U,V));return G((W<<Y)|(W>>>(32-Y)),X)},P=function(W,X,Y,Z,U,e,V){return F((X&Y)|((~X)&Z),W,X,U,e,V)},H=function(W,X,Y,Z,U,e,V){return F((X&Z)|(Y&(~Z)),W,X,U,e,V)},D=function(W,X,Y,Z,U,e,V){return F(X^Y^Z,W,X,U,e,V)},L=function(W,X,Y,Z,U,e,V){return F(Y^(X|(~Z)),W,X,U,e,V)},T=function(U,Z){var V=U[0],W=U[1],X=U[2],Y=U[3];V=P(V,W,X,Y,Z[0],7,-680876936);Y=P(Y,V,W,X,Z[1],12,-389564586);X=P(X,Y,V,W,Z[2],17,606105819);W=P(W,X,Y,V,Z[3],22,-1044525330);V=P(V,W,X,Y,Z[4],7,-176418897);Y=P(Y,V,W,X,Z[5],12,1200080426);X=P(X,Y,V,W,Z[6],17,-1473231341);W=P(W,X,Y,V,Z[7],22,-45705983);V=P(V,W,X,Y,Z[8],7,1770035416);Y=P(Y,V,W,X,Z[9],12,-1958414417);X=P(X,Y,V,W,Z[10],17,-42063);W=P(W,X,Y,V,Z[11],22,-1990404162);V=P(V,W,X,Y,Z[12],7,1804603682);Y=P(Y,V,W,X,Z[13],12,-40341101);X=P(X,Y,V,W,Z[14],17,-1502002290);W=P(W,X,Y,V,Z[15],22,1236535329);V=H(V,W,X,Y,Z[1],5,-165796510);Y=H(Y,V,W,X,Z[6],9,-1069501632);X=H(X,Y,V,W,Z[11],14,643717713);W=H(W,X,Y,V,Z[0],20,-373897302);V=H(V,W,X,Y,Z[5],5,-701558691);Y=H(Y,V,W,X,Z[10],9,38016083);X=H(X,Y,V,W,Z[15],14,-660478335);W=H(W,X,Y,V,Z[4],20,-405537848);V=H(V,W,X,Y,Z[9],5,568446438);Y=H(Y,V,W,X,Z[14],9,-1019803690);X=H(X,Y,V,W,Z[3],14,-187363961);W=H(W,X,Y,V,Z[8],20,1163531501);V=H(V,W,X,Y,Z[13],5,-1444681467);Y=H(Y,V,W,X,Z[2],9,-51403784);X=H(X,Y,V,W,Z[7],14,1735328473);W=H(W,X,Y,V,Z[12],20,-1926607734);V=D(V,W,X,Y,Z[5],4,-378558);Y=D(Y,V,W,X,Z[8],11,-2022574463);X=D(X,Y,V,W,Z[11],16,1839030562);W=D(W,X,Y,V,Z[14],23,-35309556);V=D(V,W,X,Y,Z[1],4,-1530992060);Y=D(Y,V,W,X,Z[4],11,1272893353);X=D(X,Y,V,W,Z[7],16,-155497632);W=D(W,X,Y,V,Z[10],23,-1094730640);V=D(V,W,X,Y,Z[13],4,681279174);Y=D(Y,V,W,X,Z[0],11,-358537222);X=D(X,Y,V,W,Z[3],16,-722521979);W=D(W,X,Y,V,Z[6],23,76029189);V=D(V,W,X,Y,Z[9],4,-640364487);Y=D(Y,V,W,X,Z[12],11,-421815835);X=D(X,Y,V,W,Z[15],16,530742520);W=D(W,X,Y,V,Z[2],23,-995338651);V=L(V,W,X,Y,Z[0],6,-198630844);Y=L(Y,V,W,X,Z[7],10,1126891415);X=L(X,Y,V,W,Z[14],15,-1416354905);W=L(W,X,Y,V,Z[5],21,-57434055);V=L(V,W,X,Y,Z[12],6,1700485571);Y=L(Y,V,W,X,Z[3],10,-1894986606);X=L(X,Y,V,W,Z[10],15,-1051523);W=L(W,X,Y,V,Z[1],21,-2054922799);V=L(V,W,X,Y,Z[8],6,1873313359);Y=L(Y,V,W,X,Z[15],10,-30611744);X=L(X,Y,V,W,Z[6],15,-1560198380);W=L(W,X,Y,V,Z[13],21,1309151649);V=L(V,W,X,Y,Z[4],6,-145523070);Y=L(Y,V,W,X,Z[11],10,-1120210379);X=L(X,Y,V,W,Z[2],15,718787259);W=L(W,X,Y,V,Z[9],21,-343485551);U[0]=G(V,U[0]);U[1]=G(W,U[1]);U[2]=G(X,U[2]);U[3]=G(Y,U[3])},N=function(U){var V=[],W;for(W=0;W<64;W+=4){V[W>>2]=U.charCodeAt(W)+(U.charCodeAt(W+1)<<8)+(U.charCodeAt(W+2)<<16)+(U.charCodeAt(W+3)<<24)}return V},I=function(V){var U=[],W;for(W=0;W<64;W+=4){U[W>>2]=V[W]+(V[W+1]<<8)+(V[W+2]<<16)+(V[W+3]<<24)}return U},K=function(Z){var V=Z.length,W=[1732584193,-271733879,-1732584194,271733878],U,b,Y,X,c,a;for(U=64;U<=V;U+=64){T(W,N(Z.substring(U-64,U)))}Z=Z.substring(U-64);b=Z.length;Y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(U=0;U<b;U+=1){Y[U>>2]|=Z.charCodeAt(U)<<((U%4)<<3)}Y[U>>2]|=128<<((U%4)<<3);if(U>55){T(W,Y);for(U=0;U<16;U+=1){Y[U]=0}}X=V*8;X=X.toString(16).match(/(.*?)(.{0,8})$/);c=parseInt(X[2],16);a=parseInt(X[1],16)||0;Y[14]=c;Y[15]=a;T(W,Y);return W},J=function(Y){var W=Y.length,X=[1732584193,-271733879,-1732584194,271733878],U,c,Z,V,d,b;for(U=64;U<=W;U+=64){T(X,I(Y.subarray(U-64,U)))}Y=(U-64)<W?Y.subarray(U-64):new Uint8Array(0);c=Y.length;Z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(U=0;U<c;U+=1){Z[U>>2]|=Y[U]<<((U%4)<<3)}Z[U>>2]|=128<<((U%4)<<3);if(U>55){T(X,Z);for(U=0;U<16;U+=1){Z[U]=0}}V=W*8;V=V.toString(16).match(/(.*?)(.{0,8})$/);d=parseInt(V[2],16);b=parseInt(V[1],16)||0;Z[14]=d;Z[15]=b;T(X,Z);return X},Q=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],R=function(U){var W="",V;for(V=0;V<4;V+=1){W+=Q[(U>>(V*8+4))&15]+Q[(U>>(V*8))&15]}return W},S=function(U){var V;for(V=0;V<U.length;V+=1){U[V]=R(U[V])}return U.join("")},E=function(U){return S(K(U))},O=function(){this.reset()};if(E("hello")!=="5d41402abc4b2a76b9719d911017c592"){G=function(U,V){var W=(U&65535)+(V&65535),X=(U>>16)+(V>>16)+(W>>16);return(X<<16)|(W&65535)}}O.prototype.append=function(U){if(/[\u0080-\uFFFF]/.test(U)){U=unescape(encodeURIComponent(U))}this.appendBinary(U);return this};O.prototype.appendBinary=function(W){this._buff+=W;this._length+=W.length;var U=this._buff.length,V;for(V=64;V<=U;V+=64){T(this._state,N(this._buff.substring(V-64,V)))}this._buff=this._buff.substr(V-64);return this};O.prototype.end=function(V){var U=this._buff,Y=U.length,X,W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Z;for(X=0;X<Y;X+=1){W[X>>2]|=U.charCodeAt(X)<<((X%4)<<3)}this._finish(W,Y);Z=!!V?this._state:S(this._state);this.reset();return Z};O.prototype._finish=function(W,Y){var X=Y,U,Z,V;W[X>>2]|=128<<((X%4)<<3);if(X>55){T(this._state,W);for(X=0;X<16;X+=1){W[X]=0}}U=this._length*8;U=U.toString(16).match(/(.*?)(.{0,8})$/);Z=parseInt(U[2],16);V=parseInt(U[1],16)||0;W[14]=Z;W[15]=V;T(this._state,W)};O.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};O.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};O.hash=function(W,V){if(/[\u0080-\uFFFF]/.test(W)){W=unescape(encodeURIComponent(W))}var U=K(W);return !!V?U:S(U)};O.hashBinary=function(V,W){var U=K(V);return !!W?U:S(U)};O.ArrayBuffer=function(){this.reset()};O.ArrayBuffer.prototype.append=function(U){var V=this._concatArrayBuffer(this._buff,U),X=V.length,W;this._length+=U.byteLength;for(W=64;W<=X;W+=64){T(this._state,I(V.subarray(W-64,W)))}this._buff=(W-64)<X?V.subarray(W-64):new Uint8Array(0);return this};O.ArrayBuffer.prototype.end=function(V){var U=this._buff,Y=U.length,W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],X,Z;for(X=0;X<Y;X+=1){W[X>>2]|=U[X]<<((X%4)<<3)}this._finish(W,Y);Z=!!V?this._state:S(this._state);this.reset();return Z};O.ArrayBuffer.prototype._finish=O.prototype._finish;O.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};O.ArrayBuffer.prototype.destroy=O.prototype.destroy;O.ArrayBuffer.prototype._concatArrayBuffer=function(U,W){var X=U.length,V=new Uint8Array(X+W.byteLength);V.set(U);V.set(new Uint8Array(W),X);return V};O.ArrayBuffer.hash=function(V,W){var U=J(new Uint8Array(V));return !!W?U:S(U)};return M.register("Md5",{init:function(){},loadFromBlob:function(a){var V=a.getSource(),e=2*1024*1024,U=Math.ceil(V.size/e),X=0,Z=this.owner,Y=new O.ArrayBuffer(),b=this,c=V.mozSlice||V.webkitSlice||V.slice,d,W;W=new FileReader();d=function(){var f,g;f=X*e;g=Math.min(f+e,V.size);W.onload=function(h){Y.append(h.target.result);Z.trigger("progress",{total:a.size,loaded:g})};W.onloadend=function(){W.onloadend=W.onload=null;if(++X<U){setTimeout(d,1)}else{setTimeout(function(){Z.trigger("load");b.result=Y.end();d=a=V=Y=null;Z.trigger("complete")},50)}};W.readAsArrayBuffer(c.call(V,f,g))};d()},getResult:function(){return this.result}})});A("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(J,H,D){var E=J.$,F="flash",I={};function G(){var M;try{M=navigator.plugins["Shockwave Flash"];M=M.description}catch(N){try{M=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(L){M="0.0"}}M=M.match(/\d+/g);return parseFloat(M[0]+"."+M[1],10)}function K(){var L={},N={},P=this.destory,Q=this,O=J.guid("webuploader_");H.apply(Q,arguments);Q.type=F;Q.exec=function(W,R){var V=this,T=V.uid,S=J.slice(arguments,2),U;N[T]=V;if(I[W]){if(!L[T]){L[T]=new I[W](V,Q)}U=L[T];if(U[R]){return U[R].apply(U,S)}}return Q.flashExec.apply(V,arguments)};function M(S,V){var T=S.type||S,U,R;U=T.split("::");R=U[0];T=U[1];if(T==="Ready"&&R===Q.uid){Q.trigger("ready")}else{if(N[R]){N[R].trigger(T.toLowerCase(),S,V)}}}C[O]=function(){var R=arguments;setTimeout(function(){M.apply(null,R)},1)};this.jsreciver=O;this.destory=function(){return P&&P.apply(this,arguments)};this.flashExec=function(U,R){var S=Q.getFlash(),T=J.slice(arguments,2);return S.exec(this.uid,U,R,T)}}J.inherits(H,{constructor:K,init:function(){var M=this.getContainer(),L=this.options,N;M.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});N='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+L.swf+'" ';if(J.browser.ie){N+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}N+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+L.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';M.html(N)},getFlash:function(){if(this._flash){return this._flash}this._flash=E("#"+this.uid).get(0);return this._flash}});K.register=function(L,M){M=I[L]=J.inherits(D,E.extend({flashExec:function(){var N=this.owner,O=this.getRuntime();return O.flashExec.apply(N,arguments)}},M));return M};if(G()>=11.4){H.addRuntime(F,K)}return K});A("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(E,D){var F=E.$;return D.register("FilePicker",{init:function(G){var I=F.extend({},G),J,H;J=I.accept&&I.accept.length;for(H=0;H<J;H++){if(!I.accept[H].title){I.accept[H].title="Files"}}delete I.button;delete I.id;delete I.container;this.flashExec("FilePicker","init",I)},destroy:function(){}})});A("runtime/flash/image",["runtime/flash/runtime"],function(D){return D.register("Image",{loadFromBlob:function(F){var E=this.owner;E.info()&&this.flashExec("Image","info",E.info());E.meta()&&this.flashExec("Image","meta",E.meta());this.flashExec("Image","loadFromBlob",F.uid)}})});A("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(E,D,G){var F=E.$;return D.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var H=this.owner,K=this.options,M=this._initAjax(),J=H._blob,L=K.server,I;M.connectRuntime(J.ruid);if(K.sendAsBinary){L+=(/\?/.test(L)?"&":"?")+F.param(H._formData);I=J.uid}else{F.each(H._formData,function(O,N){M.exec("append",O,N)});M.exec("appendBlob",K.fileVal,J.uid,K.filename||H._formData.name||"")}this._setRequestHeader(M,K.headers);M.exec("send",{method:K.method,url:L,mimeType:"application/octet-stream"},I)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var H=this._xhr;if(H){H.exec("abort");H.destroy();this._xhr=H=null}},destroy:function(){this.abort()},_initAjax:function(){var I=this,H=new G("XMLHttpRequest");H.on("uploadprogress progress",function(K){var J=K.loaded/K.total;J=Math.min(1,Math.max(0,J));return I.trigger("progress",J)});H.on("load",function(){var J=H.exec("getStatus"),K="";H.off();I._xhr=null;if(J>=200&&J<300){I._response=H.exec("getResponse");I._responseJson=H.exec("getResponseAsJson")}else{if(J>=500&&J<600){I._response=H.exec("getResponse");I._responseJson=H.exec("getResponseAsJson");K="server"}else{K="http"}}I._response=decodeURIComponent(I._response);H.destroy();H=null;return K?I.trigger("error",K):I.trigger("load")});H.on("error",function(){H.off();I._xhr=null;I.trigger("error","http")});I._xhr=H;return H},_setRequestHeader:function(I,H){F.each(H,function(J,K){I.exec("setRequestHeader",J,K)})}})});A("runtime/flash/md5",["runtime/flash/runtime"],function(D){return D.register("Md5",{init:function(){},loadFromBlob:function(E){return this.flashExec("Md5","loadFromBlob",E.uid)}})});A("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/md5"],function(D){return D});A("webuploader",["preset/all"],function(D){return D});return B("webuploader")});